
<div #addElement class="grid grid-cols-1 pb-8 gap-8 mx-5 md:grid-cols-1 md:mx-20 lg:grid-cols-2 lg:mx-20 xl:grid-cols-2 xl:mx-14">
    @for (crane of cranes; track crane.id){
        <p-card class="mt-2 lg:mt-10 shadow-xl" [header]="crane.name">
            <ng-template pTemplate="header">
                <img alt="Card" [src]="crane.imgUrl"/>
            </ng-template>
            <p class="pb-4 text-lg font-extrabold lg:text-2xl">{{formatPrice(crane.price)}}</p>
            <p class="block text-sm lg:text-lg">Maximális kinyúlás / markoló nyitva: {{crane.reachMax}} / {{crane.reachWithGrabOpen}} m</p>
            <p class="block text-sm lg:text-lg">Nettó emelő nyomaték: {{crane.liftingTorqueNet}} kNm</p>
            <p class="block text-sm lg:text-lg">Emelőképesség 4 m-es markolóval: {{crane.liftingCapacity}} kg</p>
            <ng-template pTemplate="footer">
                <div class="grid grid-cols-2 mb-4">  
                    <div class="">
                      <button (click)="addToCalculator(crane)" label="Kalkulál" 
                      class="mb-2 rounded bg-[#8ac73c] text-black hover:cursor-pointer hover:opacity-85 px-2 pt-4 pb-3.5 text-sm font-bold lg:px-4 xl:px-12">Kalkulál</button>

                    </div>             
                    <div class="justify-self-end">
                      <button (click)="navigateToMachine(crane.id)" label="További információ" 
                      class="mb-2 rounded bg-[rgba(0,0,0,.3)] text-white hover:cursor-pointer hover:opacity-85 px-2 pt-4 pb-3.5 text-sm font-bold lg:px-4 xl:px-12">További információ</button>
                    </div>
                   
                  </div>           
            </ng-template>
        </p-card>
    } 
    @empty {
        <p>There are no cranes.</p>
    }
  </div>
  <!-- <div *ngIf="!equipmentSelected" class="h-dvh">

  </div> -->
  <div class="bg-slate-200">

    <form [formGroup]="formGroup">

      <div *ngIf="equipmentSelected" #configElement class="flex align-middle justify-center my-10">

        <div class="w-11/12">
            <div class="justify-content-center my-4 py-4">
              <span>Vezértömb</span>
              <p-listbox #controlBlockListBox (onChange)="handleControlBlockChange($event)" [options]="controlBlocks" formControlName="selectedControlBlock" optionLabel="name"></p-listbox>                   
            </div>
        
            <div class="justify-content-center my-4 py-4">
                <span>Rotátor + közbetét</span>
                <p-listbox #rotatorListBox (onChange)="handleRotatorChange($event)" [options]="rotators" formControlName="selectedRotator" optionLabel="name"></p-listbox>
            </div>
    
            <div class="justify-content-center my-4 py-4">
                <span>Rotátorfék</span>
                <p-listbox #rotatorBrakeListBox (onChange)="handleRotatorBrakeChange($event)" [options]="rotatorBrakes" formControlName="selectedRotatorBrake" optionLabel="name"></p-listbox>
            </div>
    
            <div class="flex gap-2 my-4">
                <p-checkbox #backrestCheckBox (onChange)="handleChange(configItems['háttámla'].name, configItems['háttámla'].price, $event)" formControlName="backRestSelected" value="selected"  inputId="háttámla"></p-checkbox>
                <label for="háttámla">{{configItems['háttámla'].name}} {{ formatPrice(configItems['háttámla'].price)}}</label>
            </div>
    
            <div class="flex gap-2 my-4">
                <p-checkbox #oilCoolerCheckBox (onChange)="handleChange(configItems['olajhűtő'].name, configItems['olajhűtő'].price, $event)"  formControlName="oilCoolerSelected" value="selected" inputId="olajhűtő"></p-checkbox>
                <label for="olajhűtő">{{configItems['olajhűtő'].name}} {{ formatPrice(configItems['olajhűtő'].price)}}</label>
            </div>
    
            <div class="flex gap-2 my-4">
                <p-checkbox #ledCheckBox (onChange)="handleChange(configItems['ledMunkalámpák'].name, configItems['ledMunkalámpák'].price, $event)"  formControlName="ledSelected" value="selected" inputId="ledMunkalámpák"></p-checkbox>
                <label for="ledMunkalámpák">{{configItems['ledMunkalámpák'].name}} {{ formatPrice(configItems['ledMunkalámpák'].price)}}</label>
            </div>
    
            <div class="flex gap-2 my-4">
                <p-checkbox #workingHoursCheckBox (onChange)="handleChange(configItems['munkaÓraSzámláló'].name, configItems['munkaÓraSzámláló'].price, $event)"  formControlName="workingHoursSelected" value="selected" inputId="munkaÓraSzámláló"></p-checkbox>
                <label for="munkaÓraSzámláló">{{configItems['munkaÓraSzámláló'].name}} {{ formatPrice(configItems['munkaÓraSzámláló'].price)}}</label>
            </div>
            
        </div>

    </div>
    
    <div *ngIf="equipmentSelected" class="flex align-middle justify-center my-10">

      <div class="w-11/12">
        <span
          class="block uppercase text-blueGray-500 text-sm font-extrabold lg:mb-12 mb-4"
        >
        Kalkulált ár:
        </span>
        <p class="font-semibold">{{formatPrice(calculatorService.price$ | async)}}</p>
        <button class="rounded-md p-2 mt-4 bg-red-500" (click)="delete()">Törlés</button>
      </div>

    </div>

    <div class="flex align-middle justify-center mt-20 pt-10">
      <div class="w-11/12">
        <div class="">
            <div class="relative flex flex-col min-w-0 break-words w-full mb-6 shadow-lg rounded-lg bg-gray-300">

                <div class="flex-auto p-5 lg:p-10">
                  <h4 class="text-2xl font-semibold">Kérdése van?</h4>
                  <p class="leading-relaxed mt-1 mb-4 text-gray-600">
                    Tegye fel nekünk üzenetben!
                  </p>

                  <!-- NAME -->
                  <div class="relative w-full mb-3 mt-8">
                    <div class="flex gap-4">
                      <label class="block uppercase text-gray-700 text-xs font-bold mb-2" for="name">Név<span class="text-red-500">*</span></label>
                      @if (submitted && f['name'].errors) {  
                        @if (f['name'].errors['required']) {
                          <p class="block text-red-500 text-xs mb-2">Kérem adja meg a nevét!</p>
                        }
                      }
                    </div> 
                    <input
                      type="text"
                      name="name"
                      formControlName="name"
                      class="border-0 px-3 py-3 placeholder-gray-400 text-gray-700 bg-white rounded text-sm shadow focus:outline-none focus:ring w-full"
                      placeholder="Név"
                      style="transition: all 0.15s ease 0s;"
                    />                             
                  </div>

                  <!-- EMAIL -->
                  <div class="relative w-full mb-3">
                    <div class="flex gap-4">
                      <label class="block uppercase text-gray-700 text-xs font-bold mb-2" for="email">Email<span class="text-red-500">*</span></label>
                      @if (submitted && f['email'].errors) {  
                        @if (f['email'].errors['required']) {
                          <p class="block text-red-500 text-xs mb-2">Kérem adja meg az e-mail címét!</p>
                        }           
                        @if (blurred && f['email'].errors?.['pattern']) {
                          <p class="block text-red-500 text-xs mb-2">Kérem valós e-mail címet adjon meg!</p>
                        }                        
                      }
                      
                    </div>
                    <input
                      type="email"
                      name="email"
                      formControlName="email"
                      (blur)="onEmailBlur()"
                      pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,4}$"
                      class="border-0 px-3 py-3 placeholder-gray-400 text-gray-700 bg-white rounded text-sm shadow focus:outline-none focus:ring w-full"
                      placeholder="Email"
                      style="transition: all 0.15s ease 0s;"
                    />
                  </div>

                  <!-- MESSAGE -->
                  <div class="relative w-full mb-3">
                    <div class="flex gap-4">
                      <label class="block uppercase text-gray-700 text-xs font-bold mb-2" for="message">Üzenet<span class="text-red-500">*</span></label>
                      @if (submitted && f['message'].errors) {  
                        @if (f['message'].errors['required']) {
                          <p class="block text-red-500 text-xs mb-2">Kérem gépeljen az üzenet mezőbe!</p>
                        }
                      }
                    </div>
                    <textarea
                      name="message"
                      formControlName="message"
                      rows="4"
                      cols="80"
                      class="border-0 px-3 py-3 placeholder-gray-400 text-gray-700 bg-white rounded text-sm shadow focus:outline-none focus:ring w-full"
                      placeholder="Kérem fogalmazza meg a kérdését..."
                    ></textarea>
                  </div>

                  <div class="text-center mt-6">
                    <button
                    (click)="onSubmit()"
                      class="bg-[#8ac73c] text-white active:bg-gray-700 text-sm font-bold uppercase px-6 py-3 rounded shadow hover:shadow-lg outline-none focus:outline-none mr-1 mb-1"
                      type="button"
                      style="transition: all 0.15s ease 0s;"
                    >
                      Küldés
                    </button>
                  </div>

              </div>
            </div>
        </div>
      </div>
    </div>
  </form>
</div>